<!DOCTYPE html>
<html lang="zh-cn">
<head>
<script src="stars.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
</head> 
<body style="margin: 0 0 0 0">
<canvas id="cav" style="background:black"></canvas>

<script>

window.onresize=function(){
w=window.innerWidth-6;
h=window.innerHeight-6;
cav.width=w;
cav.height=h;
con.lineWidth=0.6;
paint();
};


//参数区
var pc=isPC();
var 
w=window.innerWidth-6,
h=window.innerHeight-6,
d,f,r,std;
fov=90;
v_distance=(w/2)/Math.tan(fov/2);


function init1(){
r=0.002;
}

init1();

var ol=0,ot=0;
var cav=document.getElementById("cav");
cav.width=w;
cav.height=h;
var con=cav.getContext("2d");
con.lineWidth=0.6;
//点坐标
var star=new Array();

function init2(){
for (var i=0;i<stars.length;i++){
star[i]=new p3d(stars[i].x,stars[i].y,stars[i].z,stars[i].r,stars[i].l);
}}
init2();
paint();

//画图区
function paint(){
con.fillStyle="black";
con.fillRect(0,0,w,h);
for(var i=0;i<stars.length;i++){
if(star[i].z>0.1){
ds(star[i],con);}}
con.fill();
}

//框架区
function p3d(x,y,z,r,l){
this.x=x;
this.y=y;
this.z=z;
this.r=r;
this.color="rgb("+Math.floor(64*l)+","+Math.floor(170*l)+","+Math.floor(255*l)+")";
this.rotateX=function (angle){
var sinA=Math.sin(angle);
var cosA=Math.cos(angle);
var tz=this.z;
var ty=this.y;
this.y=ty*cosA-tz*sinA;
this.z=ty*sinA+tz*cosA;
};
this.rotateY=function (angle){
var sinA=Math.sin(angle);
var cosA=Math.cos(angle);
var tz=this.z;
var tx=this.x;
this.z=tz*cosA-tx*sinA;
this.x=tz*sinA+tx*cosA;
};}

function ds(s,con){
con.fillStyle=s.color;
var tx=s.x*v_distance/s.z;
var ty=-s.y*v_distance/s.z;
if(pc){tx=tx+w/2;ty=ty+h/2;}
else{tx=tx+h/2;ty=ty+w/2;}
con.fillRect(tx,ty,s.r,s.r);
}

//转动区
window.onload = function(){
var flag=false;//是否按下

var start=function(e){
e.stopPropagation();
e.preventDefault();

if(!e.touches){
ol=e.clientX;
ot=e.clientY;
}else{
ol=e.touches[0].pageX;
ot=e.touches[0].pageY;
}
flag = true;
}

var move=function(e){
if(!flag)return;

var ax,ay;

if(!e.touches){
ax = (e.clientX - ol)*r;
ay = (e.clientY - ot)*r; 
}else{
ax = (e.touches[0].pageX - ol)*r;
ay = (e.touches[0].pageY - ot)*r;
}
if(pc){
for(let k in star){
star[k].rotateY(-ax);
star[k].rotateX(-ay);
}
}else{
for(let k in star){
star[k].rotateX(ax);
star[k].rotateY(ay);
}}
paint();

if(!e.touches){
ol = e.clientX;
ot = e.clientY;
}else{
ol=e.touches[0].pageX;
ot=e.touches[0].pageY;
}}

var end=function(e){
flag=false;
}

cav.addEventListener("touchstart", start);
cav.addEventListener("mousedown", start);
window.addEventListener("touchmove", move);
window.addEventListener("mousemove", move);
window.addEventListener("touchend", end);
window.addEventListener("mouseup", end);
}

//判断浏览器函数
function isPC(){
if(window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)) {
return false;
}else{
return true;
}}
</script>

</body>
</html>